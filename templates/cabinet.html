{% extends "base.html" %}
{% block content %}

<h2 id="cabinet-title">–ö–∞–±–∏–Ω–µ—Ç</h2>
<p id="cabinet-status">–°—Ç–∞—Ç—É—Å: <span class="status-inactive">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>

<div class="settings-container">
  <div class="settings-title">Settings</div>
  <button id="toggle-btn">–ó–∞–≥—Ä—É–∑–∫–∞...</button>
  <button onclick="alert('üìã –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π</button>
  <button onclick="alert('‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏</button>
  <button onclick="alert('‚öôÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
</div>

<script>
const cabinetId = {{ cabinet_id }};
const tg = window.Telegram.WebApp;
tg.expand();

(async () => {
  const user = tg.initDataUnsafe?.user;
  if (!user) {
    alert("‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –≤–Ω–µ Telegram");
    return;
  }

  const res = await fetch(`/dashboard/api/user/${user.id}`);
  const data = await res.json();
  const cab = data.cabinets.find(c => c.id === cabinetId);
  if (!cab) {
    document.getElementById("cabinet-title").innerText = "–ö–∞–±–∏–Ω–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω";
    return;
  }

  document.getElementById("cabinet-title").innerText = cab.name;
  document.getElementById("cabinet-status").innerHTML =
    "–°—Ç–∞—Ç—É—Å: " + (cab.active
      ? '<span class="status-active">üü¢ –ê–∫—Ç–∏–≤–µ–Ω</span>'
      : '<span class="status-inactive">üî¥ –û—Ç–∫–ª—é—á–µ–Ω</span>');

  const toggleBtn = document.getElementById("toggle-btn");
  toggleBtn.innerText = cab.active ? "–í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç" : "–í–∫–ª—é—á–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç";
  toggleBtn.onclick = async () => {
    const resp = await fetch(`/dashboard/api/toggle/${cabinetId}`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({telegram_id: user.id})
    });
    const r = await resp.json();
    alert(r.message);
    location.reload();
  };
})();
</script>

{% endblock %}
